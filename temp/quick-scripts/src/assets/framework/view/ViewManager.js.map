{"version":3,"sources":["assets\\framework\\view\\ViewManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["/**\r\n * 基于一个场景上的视图管理:\r\n * 1. (同步或者异步)显示一个 View\r\n * 2. (同步或者异步)显示一个 Item\r\n * 3. 回收一个视图节点\r\n */\r\nexport default class ViewManager {\r\n    static singleInstance: ViewManager = null;\r\n    static getInstance(): ViewManager {\r\n        if (ViewManager.singleInstance == null) {\r\n            ViewManager.singleInstance = new ViewManager();\r\n        }\r\n        return ViewManager.singleInstance;\r\n    }\r\n\r\n    viewStack: bb.ViewCtrl[] =  null;\r\n    constructor() {\r\n        this.viewStack = [];\r\n    }\r\n\r\n    \r\n    showView(name: string,  prefab: cc.Prefab, data: any): bb.ViewCtrl {\r\n        let viewCtrl = new bb.ViewCtrl();\r\n        \r\n        viewCtrl.node = cc.instantiate(prefab);\r\n        viewCtrl.data = data;\r\n        viewCtrl[\"_tag\"] = \"view\";\r\n        if (name) {\r\n            viewCtrl.node.name = name;\r\n        }\r\n      \r\n        cc.director.getScene().addChild(viewCtrl.node);\r\n\r\n        let components = viewCtrl.node[\"_components\"];\r\n        if (components.length > 0) {\r\n            viewCtrl.logicComponet = components[components.length - 1];\r\n            viewCtrl.logicComponet[\"viewCtrl\"] = viewCtrl;\r\n            viewCtrl.logicComponet[\"initBind\"]();\r\n            viewCtrl.logicComponet[\"onEnter\"]();\r\n        }\r\n\r\n        if (this.viewStack.length) {\r\n            this.viewStack[this.viewStack.length - 1].hideView();\r\n        }\r\n       \r\n        let key = cc.loader[\"_getReferenceKey\"](prefab);\r\n        viewCtrl[\"_referenceKey\"] = key;\r\n        this.viewStack.push(viewCtrl);\r\n        bb.UILoader.retatinRes(key);\r\n        bb.UILoader.retainNodeRes(viewCtrl.node);\r\n       return viewCtrl;\r\n    }\r\n\r\n   \r\n    showViewSync(pathStr: string, data: any,  callback?: (viewCtrl: bb.ViewCtrl)=>{}) {\r\n        bb.UILoader.loadRes(pathStr, cc.Prefab, (prefab) => {\r\n            let viewCtrl  = this.showView(prefab.name, prefab, data);\r\n            if (callback) {\r\n                callback(viewCtrl);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    showSubView(name: string,  prefab: cc.Prefab, data: any):  bb.ViewCtrl {\r\n        let viewCtrl = new bb.ViewCtrl();\r\n        viewCtrl.node = cc.instantiate(prefab);\r\n        viewCtrl.data = data;\r\n        viewCtrl[\"_tag\"] = \"subView\";\r\n        if (name) {\r\n            viewCtrl.node.name = name;\r\n        }\r\n      \r\n        viewCtrl[\"parentViewCtrl\"] =   this.viewStack[this.viewStack.length - 1];\r\n        this.viewStack[this.viewStack.length - 1].node.addChild(viewCtrl.node);\r\n        let components = viewCtrl.node[\"_components\"];\r\n        if (components.length > 0) {\r\n            viewCtrl.logicComponet = components[components.length - 1];\r\n            viewCtrl.logicComponet[\"viewCtrl\"] = viewCtrl;\r\n            viewCtrl.logicComponet[\"initBind\"]();\r\n            viewCtrl.logicComponet[\"onEnter\"]();\r\n        }\r\n        this.viewStack[this.viewStack.length - 1].addSubViewCtrl(viewCtrl);\r\n        let key = cc.loader[\"_getReferenceKey\"](prefab);\r\n        viewCtrl[\"_referenceKey\"] = key;\r\n        bb.UILoader.retatinRes(key);\r\n        bb.UILoader.retainNodeRes(viewCtrl.node);\r\n       return viewCtrl;\r\n    }\r\n\r\n    showSubViewSync(pathStr: string, data: any,  callback?: (viewCtrl: bb.ViewCtrl)=>{}) {\r\n        bb.UILoader.loadRes(pathStr, cc.Prefab, (prefab) => {\r\n            let viewCtrl  = this.showSubView(prefab.name, prefab, data);\r\n            if (callback) {\r\n                callback(viewCtrl);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    showItem(name: string,  prefab: cc.Prefab, data: any, parent: cc.Node, parentViewCtrl: bb.ViewCtrl) {\r\n        let viewCtrl = new bb.ViewCtrl();\r\n        viewCtrl.node = cc.instantiate(prefab);\r\n        viewCtrl.data = data;\r\n        viewCtrl[\"_tag\"] = \"item\";\r\n        if (name) {\r\n            viewCtrl.node.name = name;\r\n        }\r\n        parent.addChild(viewCtrl.node);\r\n        viewCtrl[\"parentViewCtrl\"] = parentViewCtrl;\r\n        let components = viewCtrl.node[\"_components\"];\r\n        if (components.length > 0) {\r\n            viewCtrl.logicComponet = components[components.length - 1];\r\n            viewCtrl.logicComponet[\"viewCtrl\"] = viewCtrl;\r\n            viewCtrl.logicComponet[\"initBind\"]();\r\n            viewCtrl.logicComponet[\"onEnter\"]();\r\n        }\r\n        parentViewCtrl.addSubViewCtrl(viewCtrl);\r\n\r\n        let key = cc.loader[\"_getReferenceKey\"](prefab);\r\n        viewCtrl[\"_referenceKey\"] = key;\r\n        bb.UILoader.retatinRes(key);\r\n        bb.UILoader.retainNodeRes(viewCtrl.node);\r\n\r\n       return viewCtrl;\r\n    }\r\n\r\n    showItemSync(pathStr: string, data: any,  parent: cc.Node, parentViewCtrl: bb.ViewCtrl, callback?: (viewCtrl: bb.ViewCtrl)=>{}) {\r\n        bb.UILoader.loadRes(pathStr, cc.Prefab, (prefab) => {\r\n            let viewCtrl  = this.showItem(prefab.name, prefab, data, parent, parentViewCtrl);\r\n            if (callback) {\r\n                callback(viewCtrl);\r\n            }\r\n        });\r\n    }\r\n\r\n    popView(depth?: number) {\r\n        if (depth !== null) {\r\n            if (this.viewStack.length <= depth) {\r\n                cc.log(`pop view depth error viewStack = ${this.viewStack.length}, depth = ${depth}`);\r\n                return;\r\n            }\r\n\r\n            let viewCtrls = this.viewStack.splice(this.viewStack.length - depth, depth);\r\n            viewCtrls.forEach((viewCtrl) => {\r\n                viewCtrl.destroyNode();\r\n            })\r\n            this.viewStack[this.viewStack.length - 1].showView();\r\n            return;\r\n        }\r\n\r\n        if (this.viewStack.length < 2) {\r\n            return;\r\n        }\r\n        let viewCtrl = this.viewStack.pop();\r\n        viewCtrl.destroyNode();\r\n        this.viewStack[this.viewStack.length - 1].showView();\r\n    }\r\n\r\n    removeView(viewCtrl: bb.ViewCtrl) {\r\n       let deleteIdx = this.viewStack.indexOf(viewCtrl);\r\n       if (deleteIdx >= 0) {\r\n           this.viewStack.splice(deleteIdx, 1)[0];\r\n       }\r\n    }\r\n}"]}