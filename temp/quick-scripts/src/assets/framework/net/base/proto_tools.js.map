{"version":3,"sources":["assets\\framework\\net\\base\\proto_tools.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["export default class proto_tools{\r\n    public static header_size: number =  10;\r\n\r\n\t// cmd_buf dataview\r\n    public static read_int8(cmd_buf, offset) {\r\n        // return cmd_buf.readInt8(offset);\r\n        return cmd_buf.getInt8(offset);\r\n    }\r\n\r\n    public static write_int8(cmd_buf, offset, value) {\r\n        // cmd_buf.writeInt8(value, offset);\r\n        cmd_buf.setInt8(offset, value);\r\n    }\r\n\r\n    public static read_int16(cmd_buf, offset) {\r\n        return cmd_buf.getInt16(offset, true);\r\n    }\r\n\r\n    public static write_int16(cmd_buf, offset, value) {\r\n        // cmd_buf.writeInt16LE(value, offset);\r\n        cmd_buf.setInt16(offset, value, true);\r\n    }\r\n\r\n    public static read_int32(cmd_buf, offset) {\r\n        // return cmd_buf.readInt32LE(offset);\r\n        return cmd_buf.getInt32(offset, true);\r\n    }\r\n\r\n    public static write_int32(cmd_buf, offset, value) {\r\n        // cmd_buf.writeInt32LE(value, offset);\r\n        cmd_buf.setInt32(offset, value, true);\r\n    }\r\n\r\n    public static read_uint32(cmd_buf, offset) {\r\n        return cmd_buf.getUint32(offset, true);\r\n    }\r\n\r\n    public static write_uint32(cmd_buf, offset, value) {\r\n        cmd_buf.setUint32(offset, value, true);\r\n    }\r\n\r\n    public static read_str(cmd_buf, offset, byte_len) {\r\n        // return cmd_buf.toString(\"utf8\", offset, offset + byte_len);\r\n        return cmd_buf.read_utf8(offset, byte_len);\r\n    }\r\n\r\n    public static write_str(cmd_buf, offset, str) {\r\n        // cmd_buf.write(str, offset);\r\n        cmd_buf.write_utf8(offset, str);\r\n    }\r\n\r\n    public static read_float(cmd_buf, offset) {\r\n        // return cmd_buf.readFloatLE(offset);\r\n        return cmd_buf.getFloat32(offset, true);\r\n    }\r\n\r\n    public static write_float(cmd_buf, offset, value) {\r\n        // cmd_buf.writeFloatLE(value, offset);\r\n        cmd_buf.setFloat32(offset, value, true);\r\n    }\r\n\r\n    public static alloc_buffer(total_len) {\r\n        // return Buffer.allocUnsafe(total_len);\r\n        var buf = new ArrayBuffer(total_len);\r\n        var dataview = new DataView(buf);\r\n\r\n        return dataview;\r\n    }\r\n\r\n    public static write_cmd_header_inbuf(cmd_buf, stype, ctype) {\r\n        this.write_int16(cmd_buf, 0, stype);\r\n        this.write_int16(cmd_buf, 2, ctype);\r\n        this.write_uint32(cmd_buf, 4, 0);\r\n        return this.header_size;\r\n    }\r\n\r\n    public static write_prototype_inbuf(cmd_buf, proto_type) {\r\n        this.write_int16(cmd_buf, 8, proto_type);\r\n    }\r\n\r\n    public static write_str_inbuf(cmd_buf, offset, str, byte_len) {\r\n        // 写入2个字节字符串长度信息;\r\n        this.write_int16(cmd_buf, offset, byte_len);\r\n        offset += 2;\r\n\r\n        this.write_str(cmd_buf, offset, str);\r\n        offset += byte_len;\r\n\r\n        return offset;\r\n    }\r\n\r\n    // 返回 str, offset\r\n    public static read_str_inbuf(cmd_buf, offset) {\r\n        var byte_len = this.read_int16(cmd_buf, offset);\r\n        offset += 2;\r\n        var str = this.read_str(cmd_buf, offset, byte_len);\r\n        offset += byte_len;\r\n\r\n        return [str, offset];\r\n    }\r\n\r\n    public static decode_empty_cmd(cmd_buf) {\r\n        var cmd = {};\r\n        cmd[0] = this.read_int16(cmd_buf, 0);\r\n        cmd[1] = this.read_int16(cmd_buf, 2);\r\n        cmd[2] = null;\r\n        return cmd;\r\n    }\r\n\r\n    public static encode_empty_cmd(stype, ctype, body) {\r\n        var cmd_buf = this.alloc_buffer(this.header_size);\r\n        this.write_cmd_header_inbuf(cmd_buf, stype, ctype);\r\n        return cmd_buf;\r\n    }\r\n\r\n    public static encode_status_cmd(stype, ctype, status) {\r\n        var cmd_buf = this.alloc_buffer(this.header_size + 2);\r\n        this.write_cmd_header_inbuf(cmd_buf, stype, ctype);\r\n        this.write_int16(cmd_buf, this.header_size, status);\r\n        return cmd_buf;\r\n    }\r\n\r\n    public static decode_status_cmd(cmd_buf) {\r\n        var cmd = {};\r\n        cmd[0] = this.read_int16(cmd_buf, 0);\r\n        cmd[1] = this.read_int16(cmd_buf, 2);\r\n        cmd[2] = this.read_int16(cmd_buf, this.header_size);\r\n\r\n        return cmd;\r\n    }\r\n\r\n    public static encode_str_cmd(stype, ctype, str) {\r\n        var byte_len = str.utf8_byte_len();\r\n        var total_len = this.header_size + 2 + byte_len;\r\n        var cmd_buf = this.alloc_buffer(total_len);\r\n        var offset = this.write_cmd_header_inbuf(cmd_buf, stype, ctype);\r\n        offset = this.write_str_inbuf(cmd_buf, offset, str, byte_len);\r\n        return cmd_buf;\r\n    }\r\n\r\n    public static decode_str_cmd(cmd_buf) {\r\n        var cmd = {};\r\n        cmd[0] = this.read_int16(cmd_buf, 0);\r\n        cmd[1] = this.read_int16(cmd_buf, 2);\r\n        var ret = this.read_str_inbuf(cmd_buf, this.header_size);\r\n        cmd[2] = ret[0];\r\n        return cmd;\r\n    }\r\n}\r\n\r\n"]}